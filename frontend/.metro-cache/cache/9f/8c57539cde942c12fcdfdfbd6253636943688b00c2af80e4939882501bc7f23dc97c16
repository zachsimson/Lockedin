{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/callSuper","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"378KbBHdmndC3iMXZ2Ix8oB3LeE=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/inherits","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"y0uNg4LxF1CLscQChxzgo5dfjvA=","exportNames":["*"],"imports":1}},{"name":"../transport.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"q68AWRvh2qc0QUlp41HSOL9aMUA=","exportNames":["*"],"imports":1}},{"name":"../globals.node.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":46,"index":91}}],"key":"RPWURBgga4vfm2ZRigByneogh6w=","exportNames":["*"],"imports":1}},{"name":"engine.io-parser","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":92},"end":{"line":3,"column":89,"index":181}}],"key":"IB5HY76c7xC+tDEPCV8b/nK76DU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"WT\", {\n    enumerable: true,\n    get: function () {\n      return WT;\n    }\n  });\n  var _babelRuntimeHelpersClassCallCheck = require(_dependencyMap[0], \"@babel/runtime/helpers/classCallCheck\");\n  var _classCallCheck = _interopDefault(_babelRuntimeHelpersClassCallCheck);\n  var _babelRuntimeHelpersCreateClass = require(_dependencyMap[1], \"@babel/runtime/helpers/createClass\");\n  var _createClass = _interopDefault(_babelRuntimeHelpersCreateClass);\n  var _babelRuntimeHelpersCallSuper = require(_dependencyMap[2], \"@babel/runtime/helpers/callSuper\");\n  var _callSuper = _interopDefault(_babelRuntimeHelpersCallSuper);\n  var _babelRuntimeHelpersInherits = require(_dependencyMap[3], \"@babel/runtime/helpers/inherits\");\n  var _inherits = _interopDefault(_babelRuntimeHelpersInherits);\n  var _transportJs = require(_dependencyMap[4], \"../transport.js\");\n  var _globalsNodeJs = require(_dependencyMap[5], \"../globals.node.js\");\n  var _engineIoParser = require(_dependencyMap[6], \"engine.io-parser\");\n  /**\n   * WebTransport transport based on the built-in `WebTransport` object.\n   *\n   * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n   * @see https://caniuse.com/webtransport\n   */\n  var WT = /*#__PURE__*/function (_Transport) {\n    function WT() {\n      (0, _classCallCheck.default)(this, WT);\n      return (0, _callSuper.default)(this, WT, arguments);\n    }\n    (0, _inherits.default)(WT, _Transport);\n    return (0, _createClass.default)(WT, [{\n      key: \"name\",\n      get: function get() {\n        return \"webtransport\";\n      }\n    }, {\n      key: \"doOpen\",\n      value: function doOpen() {\n        var _this = this;\n        try {\n          // @ts-ignore\n          this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        } catch (err) {\n          return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed.then(function () {\n          _this.onClose();\n        }).catch(function (err) {\n          _this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(function () {\n          _this._transport.createBidirectionalStream().then(function (stream) {\n            var decoderStream = (0, _engineIoParser.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, _this.socket.binaryType);\n            var reader = stream.readable.pipeThrough(decoderStream).getReader();\n            var encoderStream = (0, _engineIoParser.createPacketEncoderStream)();\n            encoderStream.readable.pipeTo(stream.writable);\n            _this._writer = encoderStream.writable.getWriter();\n            var _read = function read() {\n              reader.read().then(function (_ref) {\n                var done = _ref.done,\n                  value = _ref.value;\n                if (done) {\n                  return;\n                }\n                _this.onPacket(value);\n                _read();\n              }).catch(function (err) {});\n            };\n            _read();\n            var packet = {\n              type: \"open\"\n            };\n            if (_this.query.sid) {\n              packet.data = `{\"sid\":\"${_this.query.sid}\"}`;\n            }\n            _this._writer.write(packet).then(function () {\n              return _this.onOpen();\n            });\n          });\n        });\n      }\n    }, {\n      key: \"write\",\n      value: function write(packets) {\n        var _this2 = this;\n        this.writable = false;\n        var _loop = function _loop() {\n          var packet = packets[i];\n          var lastPacket = i === packets.length - 1;\n          _this2._writer.write(packet).then(function () {\n            if (lastPacket) {\n              (0, _globalsNodeJs.nextTick)(function () {\n                _this2.writable = true;\n                _this2.emitReserved(\"drain\");\n              }, _this2.setTimeoutFn);\n            }\n          });\n        };\n        for (var i = 0; i < packets.length; i++) {\n          _loop();\n        }\n      }\n    }, {\n      key: \"doClose\",\n      value: function doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n      }\n    }]);\n  }(_transportJs.Transport);\n});","lineCount":124,"map":[[12,2,12,0,"Object"],[12,8,12,0],[12,9,12,0,"defineProperty"],[12,23,12,0],[12,24,12,0,"exports"],[12,31,12,0],[13,4,12,0,"enumerable"],[13,14,12,0],[14,4,12,0,"get"],[14,7,12,0],[14,18,12,0,"get"],[14,19,12,0],[15,6,12,0],[15,13,12,0,"WT"],[15,15,12,0],[16,4,12,0],[17,2,12,0],[18,2,80,1],[18,6,80,1,"_babelRuntimeHelpersClassCallCheck"],[18,40,80,1],[18,43,80,1,"require"],[18,50,80,1],[18,51,80,1,"_dependencyMap"],[18,65,80,1],[19,2,80,1],[19,6,80,1,"_classCallCheck"],[19,21,80,1],[19,24,80,1,"_interopDefault"],[19,39,80,1],[19,40,80,1,"_babelRuntimeHelpersClassCallCheck"],[19,74,80,1],[20,2,80,1],[20,6,80,1,"_babelRuntimeHelpersCreateClass"],[20,37,80,1],[20,40,80,1,"require"],[20,47,80,1],[20,48,80,1,"_dependencyMap"],[20,62,80,1],[21,2,80,1],[21,6,80,1,"_createClass"],[21,18,80,1],[21,21,80,1,"_interopDefault"],[21,36,80,1],[21,37,80,1,"_babelRuntimeHelpersCreateClass"],[21,68,80,1],[22,2,80,1],[22,6,80,1,"_babelRuntimeHelpersCallSuper"],[22,35,80,1],[22,38,80,1,"require"],[22,45,80,1],[22,46,80,1,"_dependencyMap"],[22,60,80,1],[23,2,80,1],[23,6,80,1,"_callSuper"],[23,16,80,1],[23,19,80,1,"_interopDefault"],[23,34,80,1],[23,35,80,1,"_babelRuntimeHelpersCallSuper"],[23,64,80,1],[24,2,80,1],[24,6,80,1,"_babelRuntimeHelpersInherits"],[24,34,80,1],[24,37,80,1,"require"],[24,44,80,1],[24,45,80,1,"_dependencyMap"],[24,59,80,1],[25,2,80,1],[25,6,80,1,"_inherits"],[25,15,80,1],[25,18,80,1,"_interopDefault"],[25,33,80,1],[25,34,80,1,"_babelRuntimeHelpersInherits"],[25,62,80,1],[26,2,1,0],[26,6,1,0,"_transportJs"],[26,18,1,0],[26,21,1,0,"require"],[26,28,1,0],[26,29,1,0,"_dependencyMap"],[26,43,1,0],[27,2,2,0],[27,6,2,0,"_globalsNodeJs"],[27,20,2,0],[27,23,2,0,"require"],[27,30,2,0],[27,31,2,0,"_dependencyMap"],[27,45,2,0],[28,2,3,0],[28,6,3,0,"_engineIoParser"],[28,21,3,0],[28,24,3,0,"require"],[28,31,3,0],[28,32,3,0,"_dependencyMap"],[28,46,3,0],[29,2,4,0],[30,0,5,0],[31,0,6,0],[32,0,7,0],[33,0,8,0],[34,0,9,0],[35,0,10,0],[36,0,11,0],[37,2,4,0],[37,6,12,13,"WT"],[37,8,12,15],[37,34,12,15,"_Transport"],[37,44,12,15],[38,4,12,15],[38,13,12,15,"WT"],[38,16,12,15],[39,6,12,15],[39,10,12,15,"_classCallCheck"],[39,25,12,15],[39,26,12,15,"default"],[39,33,12,15],[39,41,12,15,"WT"],[39,43,12,15],[40,6,12,15],[40,17,12,15,"_callSuper"],[40,27,12,15],[40,28,12,15,"default"],[40,35,12,15],[40,43,12,15,"WT"],[40,45,12,15],[40,47,12,15,"arguments"],[40,56,12,15],[41,4,12,15],[42,4,12,15],[42,8,12,15,"_inherits"],[42,17,12,15],[42,18,12,15,"default"],[42,25,12,15],[42,27,12,15,"WT"],[42,29,12,15],[42,31,12,15,"_Transport"],[42,41,12,15],[43,4,12,15],[43,15,12,15,"_createClass"],[43,27,12,15],[43,28,12,15,"default"],[43,35,12,15],[43,37,12,15,"WT"],[43,39,12,15],[44,6,12,15,"key"],[44,9,12,15],[45,6,12,15,"get"],[45,9,12,15],[45,11,13,4],[45,20,13,4,"get"],[45,24,13,4],[45,26,13,15],[46,8,14,8],[46,15,14,15],[46,29,14,29],[47,6,15,4],[48,4,15,5],[49,6,15,5,"key"],[49,9,15,5],[50,6,15,5,"value"],[50,11,15,5],[50,13,16,4],[50,22,16,4,"doOpen"],[50,28,16,10,"doOpen"],[50,29,16,10],[50,31,16,13],[51,8,16,13],[51,12,16,13,"_this"],[51,17,16,13],[52,8,17,8],[52,12,17,12],[53,10,18,12],[54,10,19,12],[54,14,19,16],[54,15,19,17,"_transport"],[54,25,19,27],[54,28,19,30],[54,32,19,34,"WebTransport"],[54,44,19,46],[54,45,19,47],[54,49,19,51],[54,50,19,52,"createUri"],[54,59,19,61],[54,60,19,62],[54,67,19,69],[54,68,19,70],[54,70,19,72],[54,74,19,76],[54,75,19,77,"opts"],[54,79,19,81],[54,80,19,82,"transportOptions"],[54,96,19,98],[54,97,19,99],[54,101,19,103],[54,102,19,104,"name"],[54,106,19,108],[54,107,19,109],[54,108,19,110],[55,8,20,8],[55,9,20,9],[55,10,21,8],[55,17,21,15,"err"],[55,20,21,18],[55,22,21,20],[56,10,22,12],[56,17,22,19],[56,21,22,23],[56,22,22,24,"emitReserved"],[56,34,22,36],[56,35,22,37],[56,42,22,44],[56,44,22,46,"err"],[56,47,22,49],[56,48,22,50],[57,8,23,8],[58,8,24,8],[58,12,24,12],[58,13,24,13,"_transport"],[58,23,24,23],[58,24,24,24,"closed"],[58,30,24,30],[58,31,25,13,"then"],[58,35,25,17],[58,36,25,18],[58,48,25,24],[59,10,26,12,"_this"],[59,15,26,16],[59,16,26,17,"onClose"],[59,23,26,24],[59,24,26,25],[59,25,26,26],[60,8,27,8],[60,9,27,9],[60,10,27,10],[60,11,28,13,"catch"],[60,16,28,18],[60,17,28,19],[60,27,28,20,"err"],[60,30,28,23],[60,32,28,28],[61,10,29,12,"_this"],[61,15,29,16],[61,16,29,17,"onError"],[61,23,29,24],[61,24,29,25],[61,44,29,45],[61,46,29,47,"err"],[61,49,29,50],[61,50,29,51],[62,8,30,8],[62,9,30,9],[62,10,30,10],[63,8,31,8],[64,8,32,8],[64,12,32,12],[64,13,32,13,"_transport"],[64,23,32,23],[64,24,32,24,"ready"],[64,29,32,29],[64,30,32,30,"then"],[64,34,32,34],[64,35,32,35],[64,47,32,41],[65,10,33,12,"_this"],[65,15,33,16],[65,16,33,17,"_transport"],[65,26,33,27],[65,27,33,28,"createBidirectionalStream"],[65,52,33,53],[65,53,33,54],[65,54,33,55],[65,55,33,56,"then"],[65,59,33,60],[65,60,33,61],[65,70,33,62,"stream"],[65,76,33,68],[65,78,33,73],[66,12,34,16],[66,16,34,22,"decoderStream"],[66,29,34,35],[66,32,34,38],[66,36,34,38,"createPacketDecoderStream"],[66,51,34,63],[66,52,34,63,"createPacketDecoderStream"],[66,77,34,63],[66,79,34,64,"Number"],[66,85,34,70],[66,86,34,71,"MAX_SAFE_INTEGER"],[66,102,34,87],[66,104,34,89,"_this"],[66,109,34,93],[66,110,34,94,"socket"],[66,116,34,100],[66,117,34,101,"binaryType"],[66,127,34,111],[66,128,34,112],[67,12,35,16],[67,16,35,22,"reader"],[67,22,35,28],[67,25,35,31,"stream"],[67,31,35,37],[67,32,35,38,"readable"],[67,40,35,46],[67,41,35,47,"pipeThrough"],[67,52,35,58],[67,53,35,59,"decoderStream"],[67,66,35,72],[67,67,35,73],[67,68,35,74,"getReader"],[67,77,35,83],[67,78,35,84],[67,79,35,85],[68,12,36,16],[68,16,36,22,"encoderStream"],[68,29,36,35],[68,32,36,38],[68,36,36,38,"createPacketEncoderStream"],[68,51,36,63],[68,52,36,63,"createPacketEncoderStream"],[68,77,36,63],[68,79,36,64],[68,80,36,65],[69,12,37,16,"encoderStream"],[69,25,37,29],[69,26,37,30,"readable"],[69,34,37,38],[69,35,37,39,"pipeTo"],[69,41,37,45],[69,42,37,46,"stream"],[69,48,37,52],[69,49,37,53,"writable"],[69,57,37,61],[69,58,37,62],[70,12,38,16,"_this"],[70,17,38,20],[70,18,38,21,"_writer"],[70,25,38,28],[70,28,38,31,"encoderStream"],[70,41,38,44],[70,42,38,45,"writable"],[70,50,38,53],[70,51,38,54,"getWriter"],[70,60,38,63],[70,61,38,64],[70,62,38,65],[71,12,39,16],[71,16,39,22,"read"],[71,21,39,26],[71,24,39,29],[71,33,39,22,"read"],[71,37,39,26,"read"],[71,38,39,26],[71,40,39,35],[72,14,40,20,"reader"],[72,20,40,26],[72,21,41,25,"read"],[72,25,41,29],[72,26,41,30],[72,27,41,31],[72,28,42,25,"then"],[72,32,42,29],[72,33,42,30],[72,43,42,30,"_ref"],[72,47,42,30],[72,49,42,51],[73,16,42,51],[73,20,42,33,"done"],[73,24,42,37],[73,27,42,37,"_ref"],[73,31,42,37],[73,32,42,33,"done"],[73,36,42,37],[74,18,42,39,"value"],[74,23,42,44],[74,26,42,44,"_ref"],[74,30,42,44],[74,31,42,39,"value"],[74,36,42,44],[75,16,43,24],[75,20,43,28,"done"],[75,24,43,32],[75,26,43,34],[76,18,44,28],[77,16,45,24],[78,16,46,24,"_this"],[78,21,46,28],[78,22,46,29,"onPacket"],[78,30,46,37],[78,31,46,38,"value"],[78,36,46,43],[78,37,46,44],[79,16,47,24,"read"],[79,21,47,28],[79,22,47,29],[79,23,47,30],[80,14,48,20],[80,15,48,21],[80,16,48,22],[80,17,49,25,"catch"],[80,22,49,30],[80,23,49,31],[80,33,49,32,"err"],[80,36,49,35],[80,38,49,40],[80,39,50,20],[80,40,50,21],[80,41,50,22],[81,12,51,16],[81,13,51,17],[82,12,52,16,"read"],[82,17,52,20],[82,18,52,21],[82,19,52,22],[83,12,53,16],[83,16,53,22,"packet"],[83,22,53,28],[83,25,53,31],[84,14,53,33,"type"],[84,18,53,37],[84,20,53,39],[85,12,53,46],[85,13,53,47],[86,12,54,16],[86,16,54,20,"_this"],[86,21,54,24],[86,22,54,25,"query"],[86,27,54,30],[86,28,54,31,"sid"],[86,31,54,34],[86,33,54,36],[87,14,55,20,"packet"],[87,20,55,26],[87,21,55,27,"data"],[87,25,55,31],[87,28,55,34],[87,39,55,45,"_this"],[87,44,55,49],[87,45,55,50,"query"],[87,50,55,55],[87,51,55,56,"sid"],[87,54,55,59],[87,58,55,63],[88,12,56,16],[89,12,57,16,"_this"],[89,17,57,20],[89,18,57,21,"_writer"],[89,25,57,28],[89,26,57,29,"write"],[89,31,57,34],[89,32,57,35,"packet"],[89,38,57,41],[89,39,57,42],[89,40,57,43,"then"],[89,44,57,47],[89,45,57,48],[90,14,57,48],[90,21,57,54,"_this"],[90,26,57,58],[90,27,57,59,"onOpen"],[90,33,57,65],[90,34,57,66],[90,35,57,67],[91,12,57,67],[91,14,57,68],[92,10,58,12],[92,11,58,13],[92,12,58,14],[93,8,59,8],[93,9,59,9],[93,10,59,10],[94,6,60,4],[95,4,60,5],[96,6,60,5,"key"],[96,9,60,5],[97,6,60,5,"value"],[97,11,60,5],[97,13,61,4],[97,22,61,4,"write"],[97,27,61,9,"write"],[97,28,61,10,"packets"],[97,35,61,17],[97,37,61,19],[98,8,61,19],[98,12,61,19,"_this2"],[98,18,61,19],[99,8,62,8],[99,12,62,12],[99,13,62,13,"writable"],[99,21,62,21],[99,24,62,24],[99,29,62,29],[100,8,62,30],[100,12,62,30,"_loop"],[100,17,62,30],[100,29,62,30,"_loop"],[100,35,62,30],[100,37,63,49],[101,10,64,12],[101,14,64,18,"packet"],[101,20,64,24],[101,23,64,27,"packets"],[101,30,64,34],[101,31,64,35,"i"],[101,32,64,36],[101,33,64,37],[102,10,65,12],[102,14,65,18,"lastPacket"],[102,24,65,28],[102,27,65,31,"i"],[102,28,65,32],[102,33,65,37,"packets"],[102,40,65,44],[102,41,65,45,"length"],[102,47,65,51],[102,50,65,54],[102,51,65,55],[103,10,66,12,"_this2"],[103,16,66,16],[103,17,66,17,"_writer"],[103,24,66,24],[103,25,66,25,"write"],[103,30,66,30],[103,31,66,31,"packet"],[103,37,66,37],[103,38,66,38],[103,39,66,39,"then"],[103,43,66,43],[103,44,66,44],[103,56,66,50],[104,12,67,16],[104,16,67,20,"lastPacket"],[104,26,67,30],[104,28,67,32],[105,14,68,20],[105,18,68,20,"nextTick"],[105,32,68,28],[105,33,68,28,"nextTick"],[105,41,68,28],[105,43,68,29],[105,55,68,35],[106,16,69,24,"_this2"],[106,22,69,28],[106,23,69,29,"writable"],[106,31,69,37],[106,34,69,40],[106,38,69,44],[107,16,70,24,"_this2"],[107,22,70,28],[107,23,70,29,"emitReserved"],[107,35,70,41],[107,36,70,42],[107,43,70,49],[107,44,70,50],[108,14,71,20],[108,15,71,21],[108,17,71,23,"_this2"],[108,23,71,27],[108,24,71,28,"setTimeoutFn"],[108,36,71,40],[108,37,71,41],[109,12,72,16],[110,10,73,12],[110,11,73,13],[110,12,73,14],[111,8,74,8],[111,9,74,9],[112,8,63,8],[112,13,63,13],[112,17,63,17,"i"],[112,18,63,18],[112,21,63,21],[112,22,63,22],[112,24,63,24,"i"],[112,25,63,25],[112,28,63,28,"packets"],[112,35,63,35],[112,36,63,36,"length"],[112,42,63,42],[112,44,63,44,"i"],[112,45,63,45],[112,47,63,47],[113,10,63,47,"_loop"],[113,15,63,47],[114,8,63,47],[115,6,75,4],[116,4,75,5],[117,6,75,5,"key"],[117,9,75,5],[118,6,75,5,"value"],[118,11,75,5],[118,13,76,4],[118,22,76,4,"doClose"],[118,29,76,11,"doClose"],[118,30,76,11],[118,32,76,14],[119,8,77,8],[119,12,77,12,"_a"],[119,14,77,14],[120,8,78,8],[120,9,78,9,"_a"],[120,11,78,11],[120,14,78,14],[120,18,78,18],[120,19,78,19,"_transport"],[120,29,78,29],[120,35,78,35],[120,39,78,39],[120,43,78,43,"_a"],[120,45,78,45],[120,50,78,50],[120,55,78,55],[120,56,78,56],[120,59,78,59],[120,64,78,64],[120,65,78,65],[120,68,78,68,"_a"],[120,70,78,70],[120,71,78,71,"close"],[120,76,78,76],[120,77,78,77],[120,78,78,78],[121,6,79,4],[122,4,79,5],[123,2,79,5],[123,4,12,24,"Transport"],[123,16,12,33],[123,17,12,33,"Transport"],[123,26,12,33],[124,0,12,33],[124,3]],"functionMap":{"names":["<global>","WT","WT#get__name","WT#doOpen","_transport.closed.then$argument_0","_transport.closed.then._catch$argument_0","_transport.ready.then$argument_0","_transport.createBidirectionalStream.then$argument_0","read","reader.read.then$argument_0","reader.read.then._catch$argument_0","_writer.write.then$argument_0","WT#write","nextTick$argument_0","WT#doClose"],"mappings":"AAA;OCW;ICC;KDE;IEC;kBCS;SDE;mBEC;SFE;mCGE;6DCC;6BCM;8BCG;qBDM;+BEC;qBFC;iBDC;gDIM,mBJ;aDC;SHC;KFC;IWC;4CDK;6BEE;qBFG;aCE;KXE;IaC;KbG;CDC"},"hasCjsExports":false},"type":"js/module"}]}