{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/callSuper","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"378KbBHdmndC3iMXZ2Ix8oB3LeE=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/inherits","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"y0uNg4LxF1CLscQChxzgo5dfjvA=","exportNames":["*"],"imports":1}},{"name":"./polling.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":39,"index":39}}],"key":"Pl+iaQVK3G0OaUHovkJUbWBEusk=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"Fetch\", {\n    enumerable: true,\n    get: function () {\n      return Fetch;\n    }\n  });\n  var _babelRuntimeHelpersClassCallCheck = require(_dependencyMap[0], \"@babel/runtime/helpers/classCallCheck\");\n  var _classCallCheck = _interopDefault(_babelRuntimeHelpersClassCallCheck);\n  var _babelRuntimeHelpersCreateClass = require(_dependencyMap[1], \"@babel/runtime/helpers/createClass\");\n  var _createClass = _interopDefault(_babelRuntimeHelpersCreateClass);\n  var _babelRuntimeHelpersCallSuper = require(_dependencyMap[2], \"@babel/runtime/helpers/callSuper\");\n  var _callSuper = _interopDefault(_babelRuntimeHelpersCallSuper);\n  var _babelRuntimeHelpersInherits = require(_dependencyMap[3], \"@babel/runtime/helpers/inherits\");\n  var _inherits = _interopDefault(_babelRuntimeHelpersInherits);\n  var _pollingJs = require(_dependencyMap[4], \"./polling.js\");\n  /**\n   * HTTP long-polling based on the built-in `fetch()` method.\n   *\n   * Usage: browser, Node.js (since v18), Deno, Bun\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   * @see https://caniuse.com/fetch\n   * @see https://nodejs.org/api/globals.html#fetch\n   */\n  var Fetch = /*#__PURE__*/function (_Polling) {\n    function Fetch() {\n      (0, _classCallCheck.default)(this, Fetch);\n      return (0, _callSuper.default)(this, Fetch, arguments);\n    }\n    (0, _inherits.default)(Fetch, _Polling);\n    return (0, _createClass.default)(Fetch, [{\n      key: \"doPoll\",\n      value: function doPoll() {\n        var _this = this;\n        this._fetch().then(function (res) {\n          if (!res.ok) {\n            return _this.onError(\"fetch read error\", res.status, res);\n          }\n          res.text().then(function (data) {\n            return _this.onData(data);\n          });\n        }).catch(function (err) {\n          _this.onError(\"fetch read error\", err);\n        });\n      }\n    }, {\n      key: \"doWrite\",\n      value: function doWrite(data, callback) {\n        var _this2 = this;\n        this._fetch(data).then(function (res) {\n          if (!res.ok) {\n            return _this2.onError(\"fetch write error\", res.status, res);\n          }\n          callback();\n        }).catch(function (err) {\n          _this2.onError(\"fetch write error\", err);\n        });\n      }\n    }, {\n      key: \"_fetch\",\n      value: function _fetch(data) {\n        var _this3 = this;\n        var _a;\n        var isPost = data !== undefined;\n        var headers = new Headers(this.opts.extraHeaders);\n        if (isPost) {\n          headers.set(\"content-type\", \"text/plain;charset=UTF-8\");\n        }\n        (_a = this.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.appendCookies(headers);\n        return fetch(this.uri(), {\n          method: isPost ? \"POST\" : \"GET\",\n          body: isPost ? data : null,\n          headers: headers,\n          credentials: this.opts.withCredentials ? \"include\" : \"omit\"\n        }).then(function (res) {\n          var _a;\n          // @ts-ignore getSetCookie() was added in Node.js v19.7.0\n          (_a = _this3.socket._cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(res.headers.getSetCookie());\n          return res;\n        });\n      }\n    }]);\n  }(_pollingJs.Polling);\n});","lineCount":95,"map":[[12,2,11,0,"Object"],[12,8,11,0],[12,9,11,0,"defineProperty"],[12,23,11,0],[12,24,11,0,"exports"],[12,31,11,0],[13,4,11,0,"enumerable"],[13,14,11,0],[14,4,11,0,"get"],[14,7,11,0],[14,18,11,0,"get"],[14,19,11,0],[15,6,11,0],[15,13,11,0,"Fetch"],[15,18,11,0],[16,4,11,0],[17,2,11,0],[18,2,56,1],[18,6,56,1,"_babelRuntimeHelpersClassCallCheck"],[18,40,56,1],[18,43,56,1,"require"],[18,50,56,1],[18,51,56,1,"_dependencyMap"],[18,65,56,1],[19,2,56,1],[19,6,56,1,"_classCallCheck"],[19,21,56,1],[19,24,56,1,"_interopDefault"],[19,39,56,1],[19,40,56,1,"_babelRuntimeHelpersClassCallCheck"],[19,74,56,1],[20,2,56,1],[20,6,56,1,"_babelRuntimeHelpersCreateClass"],[20,37,56,1],[20,40,56,1,"require"],[20,47,56,1],[20,48,56,1,"_dependencyMap"],[20,62,56,1],[21,2,56,1],[21,6,56,1,"_createClass"],[21,18,56,1],[21,21,56,1,"_interopDefault"],[21,36,56,1],[21,37,56,1,"_babelRuntimeHelpersCreateClass"],[21,68,56,1],[22,2,56,1],[22,6,56,1,"_babelRuntimeHelpersCallSuper"],[22,35,56,1],[22,38,56,1,"require"],[22,45,56,1],[22,46,56,1,"_dependencyMap"],[22,60,56,1],[23,2,56,1],[23,6,56,1,"_callSuper"],[23,16,56,1],[23,19,56,1,"_interopDefault"],[23,34,56,1],[23,35,56,1,"_babelRuntimeHelpersCallSuper"],[23,64,56,1],[24,2,56,1],[24,6,56,1,"_babelRuntimeHelpersInherits"],[24,34,56,1],[24,37,56,1,"require"],[24,44,56,1],[24,45,56,1,"_dependencyMap"],[24,59,56,1],[25,2,56,1],[25,6,56,1,"_inherits"],[25,15,56,1],[25,18,56,1,"_interopDefault"],[25,33,56,1],[25,34,56,1,"_babelRuntimeHelpersInherits"],[25,62,56,1],[26,2,1,0],[26,6,1,0,"_pollingJs"],[26,16,1,0],[26,19,1,0,"require"],[26,26,1,0],[26,27,1,0,"_dependencyMap"],[26,41,1,0],[27,2,2,0],[28,0,3,0],[29,0,4,0],[30,0,5,0],[31,0,6,0],[32,0,7,0],[33,0,8,0],[34,0,9,0],[35,0,10,0],[36,2,2,0],[36,6,11,13,"Fetch"],[36,11,11,18],[36,37,11,18,"_Polling"],[36,45,11,18],[37,4,11,18],[37,13,11,18,"Fetch"],[37,19,11,18],[38,6,11,18],[38,10,11,18,"_classCallCheck"],[38,25,11,18],[38,26,11,18,"default"],[38,33,11,18],[38,41,11,18,"Fetch"],[38,46,11,18],[39,6,11,18],[39,17,11,18,"_callSuper"],[39,27,11,18],[39,28,11,18,"default"],[39,35,11,18],[39,43,11,18,"Fetch"],[39,48,11,18],[39,50,11,18,"arguments"],[39,59,11,18],[40,4,11,18],[41,4,11,18],[41,8,11,18,"_inherits"],[41,17,11,18],[41,18,11,18,"default"],[41,25,11,18],[41,27,11,18,"Fetch"],[41,32,11,18],[41,34,11,18,"_Polling"],[41,42,11,18],[42,4,11,18],[42,15,11,18,"_createClass"],[42,27,11,18],[42,28,11,18,"default"],[42,35,11,18],[42,37,11,18,"Fetch"],[42,42,11,18],[43,6,11,18,"key"],[43,9,11,18],[44,6,11,18,"value"],[44,11,11,18],[44,13,12,4],[44,22,12,4,"doPoll"],[44,28,12,10,"doPoll"],[44,29,12,10],[44,31,12,13],[45,8,12,13],[45,12,12,13,"_this"],[45,17,12,13],[46,8,13,8],[46,12,13,12],[46,13,13,13,"_fetch"],[46,19,13,19],[46,20,13,20],[46,21,13,21],[46,22,14,13,"then"],[46,26,14,17],[46,27,14,18],[46,37,14,19,"res"],[46,40,14,22],[46,42,14,27],[47,10,15,12],[47,14,15,16],[47,15,15,17,"res"],[47,18,15,20],[47,19,15,21,"ok"],[47,21,15,23],[47,23,15,25],[48,12,16,16],[48,19,16,23,"_this"],[48,24,16,27],[48,25,16,28,"onError"],[48,32,16,35],[48,33,16,36],[48,51,16,54],[48,53,16,56,"res"],[48,56,16,59],[48,57,16,60,"status"],[48,63,16,66],[48,65,16,68,"res"],[48,68,16,71],[48,69,16,72],[49,10,17,12],[50,10,18,12,"res"],[50,13,18,15],[50,14,18,16,"text"],[50,18,18,20],[50,19,18,21],[50,20,18,22],[50,21,18,23,"then"],[50,25,18,27],[50,26,18,28],[50,36,18,29,"data"],[50,40,18,33],[51,12,18,33],[51,19,18,38,"_this"],[51,24,18,42],[51,25,18,43,"onData"],[51,31,18,49],[51,32,18,50,"data"],[51,36,18,54],[51,37,18,55],[52,10,18,55],[52,12,18,56],[53,8,19,8],[53,9,19,9],[53,10,19,10],[53,11,20,13,"catch"],[53,16,20,18],[53,17,20,19],[53,27,20,20,"err"],[53,30,20,23],[53,32,20,28],[54,10,21,12,"_this"],[54,15,21,16],[54,16,21,17,"onError"],[54,23,21,24],[54,24,21,25],[54,42,21,43],[54,44,21,45,"err"],[54,47,21,48],[54,48,21,49],[55,8,22,8],[55,9,22,9],[55,10,22,10],[56,6,23,4],[57,4,23,5],[58,6,23,5,"key"],[58,9,23,5],[59,6,23,5,"value"],[59,11,23,5],[59,13,24,4],[59,22,24,4,"doWrite"],[59,29,24,11,"doWrite"],[59,30,24,12,"data"],[59,34,24,16],[59,36,24,18,"callback"],[59,44,24,26],[59,46,24,28],[60,8,24,28],[60,12,24,28,"_this2"],[60,18,24,28],[61,8,25,8],[61,12,25,12],[61,13,25,13,"_fetch"],[61,19,25,19],[61,20,25,20,"data"],[61,24,25,24],[61,25,25,25],[61,26,26,13,"then"],[61,30,26,17],[61,31,26,18],[61,41,26,19,"res"],[61,44,26,22],[61,46,26,27],[62,10,27,12],[62,14,27,16],[62,15,27,17,"res"],[62,18,27,20],[62,19,27,21,"ok"],[62,21,27,23],[62,23,27,25],[63,12,28,16],[63,19,28,23,"_this2"],[63,25,28,27],[63,26,28,28,"onError"],[63,33,28,35],[63,34,28,36],[63,53,28,55],[63,55,28,57,"res"],[63,58,28,60],[63,59,28,61,"status"],[63,65,28,67],[63,67,28,69,"res"],[63,70,28,72],[63,71,28,73],[64,10,29,12],[65,10,30,12,"callback"],[65,18,30,20],[65,19,30,21],[65,20,30,22],[66,8,31,8],[66,9,31,9],[66,10,31,10],[66,11,32,13,"catch"],[66,16,32,18],[66,17,32,19],[66,27,32,20,"err"],[66,30,32,23],[66,32,32,28],[67,10,33,12,"_this2"],[67,16,33,16],[67,17,33,17,"onError"],[67,24,33,24],[67,25,33,25],[67,44,33,44],[67,46,33,46,"err"],[67,49,33,49],[67,50,33,50],[68,8,34,8],[68,9,34,9],[68,10,34,10],[69,6,35,4],[70,4,35,5],[71,6,35,5,"key"],[71,9,35,5],[72,6,35,5,"value"],[72,11,35,5],[72,13,36,4],[72,22,36,4,"_fetch"],[72,28,36,10,"_fetch"],[72,29,36,11,"data"],[72,33,36,15],[72,35,36,17],[73,8,36,17],[73,12,36,17,"_this3"],[73,18,36,17],[74,8,37,8],[74,12,37,12,"_a"],[74,14,37,14],[75,8,38,8],[75,12,38,14,"isPost"],[75,18,38,20],[75,21,38,23,"data"],[75,25,38,27],[75,30,38,32,"undefined"],[75,39,38,41],[76,8,39,8],[76,12,39,14,"headers"],[76,19,39,21],[76,22,39,24],[76,26,39,28,"Headers"],[76,33,39,35],[76,34,39,36],[76,38,39,40],[76,39,39,41,"opts"],[76,43,39,45],[76,44,39,46,"extraHeaders"],[76,56,39,58],[76,57,39,59],[77,8,40,8],[77,12,40,12,"isPost"],[77,18,40,18],[77,20,40,20],[78,10,41,12,"headers"],[78,17,41,19],[78,18,41,20,"set"],[78,21,41,23],[78,22,41,24],[78,36,41,38],[78,38,41,40],[78,64,41,66],[78,65,41,67],[79,8,42,8],[80,8,43,8],[80,9,43,9,"_a"],[80,11,43,11],[80,14,43,14],[80,18,43,18],[80,19,43,19,"socket"],[80,25,43,25],[80,26,43,26,"_cookieJar"],[80,36,43,36],[80,42,43,42],[80,46,43,46],[80,50,43,50,"_a"],[80,52,43,52],[80,57,43,57],[80,62,43,62],[80,63,43,63],[80,66,43,66],[80,71,43,71],[80,72,43,72],[80,75,43,75,"_a"],[80,77,43,77],[80,78,43,78,"appendCookies"],[80,91,43,91],[80,92,43,92,"headers"],[80,99,43,99],[80,100,43,100],[81,8,44,8],[81,15,44,15,"fetch"],[81,20,44,20],[81,21,44,21],[81,25,44,25],[81,26,44,26,"uri"],[81,29,44,29],[81,30,44,30],[81,31,44,31],[81,33,44,33],[82,10,45,12,"method"],[82,16,45,18],[82,18,45,20,"isPost"],[82,24,45,26],[82,27,45,29],[82,33,45,35],[82,36,45,38],[82,41,45,43],[83,10,46,12,"body"],[83,14,46,16],[83,16,46,18,"isPost"],[83,22,46,24],[83,25,46,27,"data"],[83,29,46,31],[83,32,46,34],[83,36,46,38],[84,10,47,12,"headers"],[84,17,47,19],[84,19,47,12,"headers"],[84,26,47,19],[85,10,48,12,"credentials"],[85,21,48,23],[85,23,48,25],[85,27,48,29],[85,28,48,30,"opts"],[85,32,48,34],[85,33,48,35,"withCredentials"],[85,48,48,50],[85,51,48,53],[85,60,48,62],[85,63,48,65],[86,8,49,8],[86,9,49,9],[86,10,49,10],[86,11,49,11,"then"],[86,15,49,15],[86,16,49,16],[86,26,49,17,"res"],[86,29,49,20],[86,31,49,25],[87,10,50,12],[87,14,50,16,"_a"],[87,16,50,18],[88,10,51,12],[89,10,52,12],[89,11,52,13,"_a"],[89,13,52,15],[89,16,52,18,"_this3"],[89,22,52,22],[89,23,52,23,"socket"],[89,29,52,29],[89,30,52,30,"_cookieJar"],[89,40,52,40],[89,46,52,46],[89,50,52,50],[89,54,52,54,"_a"],[89,56,52,56],[89,61,52,61],[89,66,52,66],[89,67,52,67],[89,70,52,70],[89,75,52,75],[89,76,52,76],[89,79,52,79,"_a"],[89,81,52,81],[89,82,52,82,"parseCookies"],[89,94,52,94],[89,95,52,95,"res"],[89,98,52,98],[89,99,52,99,"headers"],[89,106,52,106],[89,107,52,107,"getSetCookie"],[89,119,52,119],[89,120,52,120],[89,121,52,121],[89,122,52,122],[90,10,53,12],[90,17,53,19,"res"],[90,20,53,22],[91,8,54,8],[91,9,54,9],[91,10,54,10],[92,6,55,4],[93,4,55,5],[94,2,55,5],[94,4,11,27,"Polling"],[94,14,11,34],[94,15,11,34,"Polling"],[94,22,11,34],[95,0,11,34],[95,3]],"functionMap":{"names":["<global>","Fetch","Fetch#doPoll","_fetch.then$argument_0","res.text.then$argument_0","_fetch.then._catch$argument_0","Fetch#doWrite","Fetch#_fetch","fetch.then$argument_0"],"mappings":"AAA;OCU;ICC;kBCE;4BCI,2BD;SDC;mBGC;SHE;KDC;IKC;kBHE;SGK;mBDC;SCE;KLC;IMC;gBCa;SDK;KNC;CDC"},"hasCjsExports":false},"type":"js/module"}]}